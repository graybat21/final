<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="net.kh.dao.QnaDao">
	<!-- 글 리스트 -->
	<select id="qnaList" resultType="qnaVO" parameterType="hashmap">
		select *
		from
		(SELECT ROW_NUMBER() OVER(ORDER BY no DESC) RNUM,
		no,
		subject,
		writer,
		content,
		reg,
		ref,
		restep
		FROM QNA
		ORDER BY ref DESC, restep ASC
		) X
		where X.RNUM between #{first} and #{last}
	</select>
	
	<!--내가 쓴 글목록 -->
	<select id="myqnaList" resultType="qnaVO" parameterType="hashmap">
		select *
		from
		(SELECT ROW_NUMBER() OVER(ORDER BY no DESC) RNUM,
		no,
		subject,
		writer,
		content,
		reg,
		ref,
		restep
		FROM QNA
		ORDER BY ref DESC, restep ASC
		) X
		where X.RNUM between #{first} and #{last} and writer=#{name}
	</select>

	<!-- 글쓰기 -->
	<insert id="qnaWrite" parameterType="qnaVO">
		insert into QNA(no, writer,
		content, reg, restep, subject) values(SEQ_QNA_NO.NEXTVAL, #{writer},
		#{content}, sysdate, #{restep}, #{subject})
	</insert>

	<!--글 상세보기 -->
	<select id="qnaView" resultType="qnaVO" parameterType="int">
		select *
		from QNA where no = #{no}
	</select>

	<!-- 수정하기 -->
	<update id="qnaModify" parameterType="qnaVO">
		update QNA set subject
		=#{subject}, content =#{content} where no =#{no}
	</update>

	<!-- 글 삭제 -->
	<delete id="qnaDelete" parameterType="int">
		delete from QNA where
		no=#{no}
	</delete>

	<select id="selectListCnt" resultType="int">
		select count(*) from QNA
	</select>

	<!-- 답변 글쓰기 -->
	<insert id="qnaRepl" parameterType="qnaVO">
		insert into QNA (no, writer, content, reg, ref, restep, subject)
		values(SEQ_QNA_NO.NEXTVAL, #{writer}, #{content}, sysdate, #{ref},
		#{restep}, #{subject})
	</insert>
</mapper>